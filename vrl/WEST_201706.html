<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>
    VFA: Rock Lobster West
  </title>
  <link rel="shortcut icon" type="image/x-icon" href="assets/img/logo.png"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- Bootstrap -->
  <link href="assets/css/bootstrap.min.css" rel="stylesheet">
  <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->
  <link href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic" rel="stylesheet">
  <!-- Extra style sheets -->
  <link href="assets/css/toolkit-light.css" rel="stylesheet">
  <link href="assets/css/application.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- extra assets (css, img) links -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js" integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg==" crossorigin=""></script>

  <style>
    .info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
    .legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
  </style>

  <!-- extra header javascript -->
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="assets/js/plotly-latest.min.js"></script>
  <script src="assets/js/flowReport.js"></script>

  <script type="text/javascript" src="assets/js/jquery.csv.min.js"></script>
  <script type="text/javascript" src="assets/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="assets/js/dataTables.bootstrap.js"></script>
  <script type="text/javascript" src="assets/js/csv_to_html_table.js"></script>
</head>

<!--<body data-spy="scroll" data-target="#subnav" data-offset="40">-->
<body data-offset="40">
  <div id="messages">
  </div>
  <div class="container">
    <div class="dashhead">
      <div class="dashhead-titles">
        <h6 class="dashhead-subtitle">Report</h6>
        <h3 class="dashhead-title">Rock Lobster West</h3>
      </div>
    </div>
    <div class="hr-divider m-y-md">
      <ul class="nav nav-pills hr-divider-content hr-divider-nav" role="tablist">
        <li role="presentation" class="active">
          <a href="#annual" role="tab" data-toggle="tab" aria-controls="annual" aria-expanded="true">Annual</a>
        </li>
        <li role="presentation" class="">
          <a href="#monthly" role="tab" data-toggle="tab" aria-controls="monthly" aria-expanded="false">Monthly</a>
        </li>
        <li role="presentation" class="">
          <a href="#models" role="tab" data-toggle="tab" aria-controls="models" aria-expanded="false">Models</a>
        </li>
      </ul>
    </div>
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="annual">
        <br><h4 align="center">
          <strong>1.1 Commercial Catch by Zone</strong>
        </h4>
        <div class="control-row">
          <p>Plot variable: <select id="map-pane-selector"></select> </br></br></p>
        </div>
        <!-- <div id="elid_0" style="height: 450px; width: 960px;" class="plotly-graph-div"> -->
          <div id="map-pane" style="height: 450px; width: 960px;"></div>
          <!-- separate file assigns GeoJSON data to 'regionsData' variable -->
          <script src="assets/data/WEST_regions.js"></script>
          <!-- main plotting script -->
          <script type="text/javascript">
            function getColor(d, divs) {
              // get color depending on array value (from colorbrew)
              return d >= divs[7] ? '#800026' :
              d >= divs[6] ? '#BD0026' :
              d >= divs[5] ? '#E31A1C' :
              d >= divs[4] ? '#FC4E2A' :
              d >= divs[3] ? '#FD8D3C' :
              d >= divs[2] ? '#FEB24C' :
              d >= divs[1] ? '#FED976' :
              '#FFEDA0';
            }
            function style(feature) {
              var feature_val = 0;
              var feature_val_array = [];
              switch (mapSelector.value) {
               case 'Catch':
               feature_val = feature.properties.catch;
               feature_val_array = [0,10,20,40,60,80,100,120];
               break;
               case 'Effort':
               feature_val = (feature.properties.effort);
               feature_val_array = [0,25,50,75,100,125,150,175];
               break;
               case 'CPUE':
               feature_val = feature.properties.cpue;
               feature_val_array = [0,0.1,0.2,0.3,0.4,0.5,0.6,0.7];
               break;
             };
             return {
               weight: 2,
               opacity: 1,
               color: 'white',
               dashArray: '3',
               fillOpacity: 0.7,
               fillColor: getColor(feature_val, feature_val_array)
             };
           }
           var mapSelector = document.querySelector('#map-pane-selector');
           assignOptions(['Catch', 'Effort', 'CPUE'], mapSelector);
           mapSelector.addEventListener('change', updatePlot, false);
           var map = L.map('map-pane').setView([-39, 142.5], 7);
           map.scrollWheelZoom.disable();
           L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            id: 'mapbox.light'
          }).addTo(map);
         var info = L.control();
         var legend = L.control({position: 'bottomright'});
         var geojson;
         updatePlot();
         function updatePlot() {
          info.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
                this.update();
                return this._div;
              };
            // method that we will use to update the control based on feature properties passed
            info.update = function (props) {
              switch (mapSelector.value) {
                case 'Catch':
                this._div.innerHTML = '<h4>Rock Lobster Catch 2016</h4>' +  (props ?
                    '<b>' + props.name + ' zone</b><br /> Total catch: ' + props.catch + ' tonnes'
                    : 'Hover over a zone');
                break;
                case 'Effort':
                this._div.innerHTML = '<h4>Rock Lobster Effort 2016</h4>' +  (props ?
                    '<b>' + props.name + ' zone</b><br /> Total effort: ' + (props.effort) + 'k potlifts'
                    : 'Hover over a zone');
                break;
                case 'CPUE':
                this._div.innerHTML = '<h4>Rock Lobster CPUE 2016</h4>' +  (props ?
                    '<b>' + props.name + ' zone</b><br /> Average CPUE: ' + props.cpue + ' kg/lift'
                    : 'Hover over a zone');
                break;
              };
            };
            info.addTo(map);
            function highlightFeature(e) {
              var layer = e.target;
              layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
              });
              if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
              }
              info.update(layer.feature.properties);
            }
            function resetHighlight(e) {
              geojson.resetStyle(e.target);
            }
            function onEachFeature(feature, layer) {
              layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight
              });
            }
            geojson = L.geoJson(regionsData, {
              style: style,
              onEachFeature: onEachFeature
            }).addTo(map);
            legend.onAdd = function(map) {
              // loop through our density intervals and generate a label with a colored square for each interval
              var grade_array = [];
              var legend_header = "";
              switch (mapSelector.value) {
                case 'Catch':
                  grade_array = [0, 10, 20, 40, 60, 80, 100, 120];
                  legend_header = "Catch (t)<br>"
                break;
                case 'Effort':
                  grade_array = [0, 25, 50, 75, 100, 125, 150, 175];
                  legend_header = "Effort (x1000)<br>"
                break;
                case 'CPUE':
                  grade_array = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7];
                  legend_header = "CPUE (kg/lift)<br>"
                break;
              }
              var div = L.DomUtil.create('div', 'info legend'),
              grades = grade_array,
              labels = [];
              div.innerHTML += legend_header;
              for (var i = 0; i < grades.length; i++) {
                div.innerHTML +='<i style="background:' + getColor(grades[i], grades) + '"></i> ' + grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
              }
              return div;
            };
            legend.addTo(map);
          };
        </script>
      <!-- </div> -->
      <p><br>Spatial breakdown of key fishery statistics from the most recent completed fishing season. Selectable as total commercial catch, fishing effort or standardised CPUE. Colour shading is weighted relative to each indicator. Top right hand box displays detailed information.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.2 Commercial Catch History</strong>
</h4>
<div id="elid_2" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
  <script>
    var display_year_data_elid_2 = [];
    var display_year_tac_data_elid_2 = [];
    var region_data_elid_2 = [];
    var catch_data_elid_2 = [];
    var tac_data_elid_2 = [];
    var unique_region_elid_2 = "";
    var current_region_elid_2 = "";
    var catch_id_elid_2 = "catch";
    var tac_id_elid_2 = "TAC";
    function getdata_elid_2() {
      Plotly.d3.csv("assets/data/WEST_201706_catch_TAC.csv", function(data){
        processData_elid_2(data)
      });
    };
    function processData_elid_2(allRows) {
      display_year_data_elid_2 = [];
      display_year_tac_data_elid_2 = [];
      region_data_elid_2 = [];
      catch_data_elid_2 = [];
      tac_data_elid_2 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        if (row['data_type'] == catch_id_elid_2) {
          display_year_data_elid_2.push( row['display_year'] );
          region_data_elid_2.push( row['region'] );
          catch_data_elid_2.push( Number(row['value']) );
        }
        if (row['data_type'] == tac_id_elid_2) {
          display_year_tac_data_elid_2.push( row['display_year'] );
          tac_data_elid_2.push( Number(row['value']) );
        }
      }
      unique_region_elid_2 = getUniques(region_data_elid_2);
      current_region_elid_2 = unique_region_elid_2[0];
      updatePlot_elid_2();  // Put it here to fix the asynchronous function issue
    }
    function updatePlot_elid_2(){
      var data = [];
      // build traces according to grouping selector (Region)
      trace_name_array = unique_region_elid_2;
      trace_y_array = region_data_elid_2
      // iterate through regions, stacking traces
      for (var i = 0; i < trace_name_array.length;  i++) {
        var trace = {
          type: "bar",
          name: trace_name_array[i],
          x: getFilteredArray(display_year_data_elid_2, [trace_y_array], [trace_name_array[i]]),
          y: getFilteredArray(catch_data_elid_2, [trace_y_array], [trace_name_array[i]]),
          marker:{
            color: stackColor(i),
            width:1
          }
        };
        data.push(trace);
      };
     //  // add a trace for TAC data
     // var trace = {
     //    type: "scatter",
     //    mode: "lines",
     //    name: "TAC",
     //    x: display_year_tac_data_elid_2,
     //    y: tac_data_elid_2,
     //    line: {
     //      shape: 'hvh',
     //      color: "DarkCrimson",
     //      width: 2
     //    },
     //  };
     //  data.push(trace);
      layout = {
        barmode: "stack",
        xaxis: {
          title: ""
        },
        yaxis: {
          title: "Total Catch (kg)",
        },
        margin: {
          l: 60, b: 60, r: 60, t: 40
        },
      };
      Plotly.newPlot("elid_2", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_2();
  </script>
</div>
<br>
<button onclick="elid_2_table_display()">Show/Hide Data</button>
<div id="elid_2_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_2_table_display() {
        var x = document.getElementById('elid_2_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_catch_TAC.csv',
      element: 'elid_2_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Total annual catch (kg) in the Rock Lobster Western Zone fishery from 1978/79 to present, displayed by fishing year. TAC was introduced to the fishery in 2001/02.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.3 Historical TAC Data</strong>
</h4>
<div id="table_TAC" style="width: 960px;">
  <script type="text/javascript">
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_TAC_table.csv',
      element: 'table_TAC',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 0, "asc" ]]
      }
    });
  </script>
</div>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.4 Annual Catch / Effort Data</strong>
</h4>
<div class="control-row">
  <p>Region: <select id="elid_3-region"></select></p>
</div>
<div id="elid_3" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_3 = [];
    var region_data_elid_3 = [];
    var catch_data_elid_3 = [];
    var effort_data_elid_3 = [];
    var unique_region_elid_3 = "";
    var current_region_elid_3 = "";
    var region_elid_3 = document.querySelector("#elid_3-region");
    region_elid_3.addEventListener("change", updatePlot_elid_3, false);

    function getdata_elid_3() {
      Plotly.d3.csv("assets/data/WEST_201706_CE_annual.csv", function(data){
        processData_elid_3(data)
      });
    };
    function processData_elid_3(allRows) {
      display_year_data_elid_3 = [];
      region_data_elid_3 = [];
      catch_data_elid_3 = [];
      effort_data_elid_3 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_3.push( row['display_year'] );
        region_data_elid_3.push( row['region'] );
        catch_data_elid_3.push( Number(row['catch']) );
        effort_data_elid_3.push( Number(row['effort']) );
      }
      unique_region_elid_3 = getUniques(region_data_elid_3);
      current_region_elid_3 = unique_region_elid_3[0];
      assignOptions(unique_region_elid_3, region_elid_3);
      updatePlot_elid_3();  // Put it here to fix the asynchronous function issue
    };
    // get filter values and build up the traces accordingly
    function getTraces_elid_3(region) {
      var return_data = [];
      var x_filter = [], y1_filter = [], y2_filter = [];
      for (var i = 0; i < display_year_data_elid_3.length;  i++) {
        if (region_data_elid_3[i] == region) {
          x_filter.push(display_year_data_elid_3[i]);
          y1_filter.push(catch_data_elid_3[i]);
          y2_filter.push(effort_data_elid_3[i]);
        };
      };
      var trace1 = {
        type: "bar",
        name: "Annual Catch (kg)",
        x: x_filter,
        y: y1_filter,
        marker: {
          color: "DarkCyan",
          width: 1
        }
      };
      var trace2 = {
        type: "scatter",
        mode: "lines",
        name: "Annual Effort (potlifts)",
        x: x_filter,
        y: y2_filter,
        yaxis: "y2",
        line: {
          color: "DarkSlateBlue",
          width: 3
        }
      };
      return_data = [trace1, trace2];
      return return_data
    };
    function updatePlot_elid_3(){
      // build traces according to grouping selector if it exists
      current_region_elid_3 = region_elid_3.value;
      data = getTraces_elid_3(current_region_elid_3);
      layout = {
        xaxis: {
          showgrid: false,
          title: ""
        },
        yaxis: {
          rangemode: "tozero",
          showgrid: false,
          title: "Annual Catch (kg)"
        },
        yaxis2: {
          rangemode: "tozero",
          showgrid: false, title: "Annual Effort (potlifts)",
          overlaying: "y",
          side: "right"
        },
        margin: {
          l: 60, b: 60, r: 60, t: 40
        },
        legend: {
          "orientation": "h",
          "x": 0.6,
          "y": 1.05
        }
      };
      Plotly.newPlot("elid_3", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_3();
  </script>
</div>
<br>
<button onclick="elid_3_table_display()">Show/Hide Data</button>
<div id="elid_3_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_3_table_display() {
        var x = document.getElementById('elid_3_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_CE_annual.csv',
      element: 'elid_3_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ], [ 0, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Total annual catch (tonnes) and effort (# pot lifts) selectable by region (Apollo Bay, Warrnambool and Portland) and for all of fishery. Data displayed by fishing season (Nov-Sept).<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.5 Length Frequency History</strong>
</h4>
<div class="control-row">
  <p>Sex: <select id="elid_4-sex"></select></p>
</div>
<div id="elid_4" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_4 = [];
    var survey_data_elid_4 = [];
    var sex_data_elid_4 = [];
    var sample_data_elid_4 = [];
    var effort_data_elid_4 = [];
    var bin_data_elid_4 = [];
    var count_data_elid_4 = [];
    var display_year_list_elid_4 = [];
    var display_list_length = 0;
    var unique_survey_elid_4 = [];
    var unique_sex_elid_4 = [];
    var current_display_year_elid_4 = "";
    var current_survey_elid_4 = "";
    var current_sex_elid_4 = "";
    var sex_elid_4 = document.querySelector("#elid_4-sex");;
    sex_elid_4.addEventListener("change", updatePlot_elid_4, false);
    var effort_weighting_elid_4 = false

    function getdata_elid_4() {
      Plotly.d3.csv("assets/data/WEST_201706_LF.csv", function(data){
        processData_elid_4(data)
      });
    };
    function processData_elid_4(allRows) {
      display_year_data_elid_4 = [];
      survey_data_elid_4 = [];
      sex_data_elid_4 = [];
      sample_data_elid_4 = [];
      effort_data_elid_4 = [];
      bin_data_elid_4 = [];
      count_data_elid_4 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_4.push( row['display_year'] );
        survey_data_elid_4.push( row['survey_id'] );
        sex_data_elid_4.push( row['sex'] );
        sample_data_elid_4.push( Number(row['sample_size']) );
        effort_data_elid_4.push( Number(row['effort']) );
        bin_data_elid_4.push( Number(row['bin']) );
        count_data_elid_4.push( Number(row['count']) );
      }
      display_year_list_elid_4 = getUniques(display_year_data_elid_4);
      display_year_list_elid_4.sort();
      unique_survey_elid_4 = getUniques(survey_data_elid_4);
      unique_sex_elid_4 = getUniques(sex_data_elid_4);
      current_sex_elid_4 = unique_sex_elid_4[0];
      assignOptions(unique_sex_elid_4, sex_elid_4);
      updatePlot_elid_4();  // Put it here to fix the asynchronous function issue
    };

    function updatePlot_elid_4(){
      current_sex_elid_4 = sex_elid_4.value;
      var data = [];
      for (var i = 0; i < display_year_list_elid_4.length;  i++){
        var curr_bins = getFilteredArray(bin_data_elid_4, [display_year_data_elid_4, sex_data_elid_4], [display_year_list_elid_4[i], current_sex_elid_4]);
        var curr_counts = getFilteredArray(count_data_elid_4, [display_year_data_elid_4, sex_data_elid_4], [display_year_list_elid_4[i], current_sex_elid_4]);
        var trace = {type: "box",
          y: getBoxData(curr_bins, curr_counts),
          name: display_year_list_elid_4[i], boxpoints: "Outliers",
          marker: {color: "DarkCyan", width: 1 },
        };
        data.push(trace);
      };
      curr_ref = 0;
      if (current_sex_elid_4 == "F") {
        curr_ref = 105
      } else {
        curr_ref = 100
      }
      var reference_shapes = [{
        type: 'line',
        xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
        yref: 'y',  // y-reference is assigned to the y-values
        x0: 0,
        y0: curr_ref,
        x1: 1,
        y1: curr_ref,
        line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
      }];
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'Length (mm)'},
        shapes: reference_shapes,
        showlegend: false,
        margin: { l: 60, b: 40, r: 60, t: 40 }
      };
      Plotly.newPlot("elid_4", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_4();
  </script>
</div>
<p><br>Boxplots of rock lobster lengths sampled in fixed site surveys between 2009/10 and 2016/17, selectable by sex (male/female). Boxplots show mean (box central line), quartiles (box edges), 95% confidence intervals (tips of bars) and outliers (dots). Dashed line is legal minimum length.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.6 Length Frequency Distribution</strong>
</h4>
<div class="control-row">
  <p>Year: <select id="elid_5-display-year"></select> Sex: <select id="elid_5-sex"></select></p>
</div>
<div id="elid_5" style="height: 320px; width: 960px;" class="plotly-graph-div">
</div>
<div id="elid_5a" style="height: 320px; width: 960px;" class="plotly-graph-div">
</div>
<div id="elid_5b" style="height: 320px; width: 960px;" class="plotly-graph-div">
</div>
<div id="elid_5c" style="height: 320px; width: 960px;" class="plotly-graph-div">
</div>
  <script>
    var display_year_data_elid_5 = [];
    var survey_data_elid_5 = [];
    var sex_data_elid_5 = [];
    var sample_data_elid_5 = [];
    var effort_data_elid_5 = [];
    var bin_data_elid_5 = [];
    var count_data_elid_5 = [];
    var display_year_list_elid_5 = [];
    var display_list_length = 0;
    var unique_survey_elid_5 = [];
    var unique_sex_elid_5 = [];
    var current_display_year_elid_5 = "";
    var current_survey_elid_5 = "";
    var current_sex_elid_5 = "";
    var max_freq_elid_5 = 100;
    var display_year_elid_5 = document.querySelector("#elid_5-display-year");
    display_year_elid_5.addEventListener("change", updatePlot_elid_5, false);
    var sex_elid_5 = document.querySelector("#elid_5-sex");;
    sex_elid_5.addEventListener("change", updatePlot_elid_5, false);
    var effort_weighting_elid_5 = true;

    function getdata_elid_5() {
      Plotly.d3.csv("assets/data/WEST_201706_LF.csv", function(data){
        processData_elid_5(data)
      });
    };
    function processData_elid_5(allRows) {
      display_year_data_elid_5 = [];
      survey_data_elid_5 = [];
      sex_data_elid_5 = [];
      sample_data_elid_5 = [];
      effort_data_elid_5 = [];
      bin_data_elid_5 = [];
      count_data_elid_5 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_5.push( row['display_year'] );
        survey_data_elid_5.push( row['survey_id'] );
        sex_data_elid_5.push( row['sex'] );
        sample_data_elid_5.push( Number(row['sample_size']) );
        effort_data_elid_5.push( Number(row['effort']) );
        bin_data_elid_5.push( Number(row['bin']) );
        count_data_elid_5.push( Number(row['count']) );
      }
      display_year_list_elid_5 = getUniques(display_year_data_elid_5);
      display_year_list_elid_5.sort();
      display_year_list_elid_5.reverse();
      display_list_length = display_year_list_elid_5.length - 3
      unique_survey_elid_5 = getUniques(survey_data_elid_5);
      unique_sex_elid_5 = getUniques(sex_data_elid_5);
      current_display_year_elid_5 = display_year_list_elid_5[0];
      current_survey_elid_5 = unique_survey_elid_5[0];
      current_sex_elid_5 = unique_sex_elid_5[0];
      assignOptions(display_year_list_elid_5.slice(0, display_list_length), display_year_elid_5);
      assignOptions(unique_sex_elid_5, sex_elid_5);
      updatePlot_elid_5();  // Put it here to fix the asynchronous function issue
    };

    function get_ref_elid5(sex){
      var ref_value = 0;
      if (sex == "F") {
        ref_value = 105;
      } else {
        ref_value = 110;
      }
      var return_shapes = [{
        type: 'line',
        xref: 'x',  // x-reference is assigned to the x-values
        yref: 'paper',  // y-reference is assigned to the plot paper [0,1]
        x0: ref_value,
        y0: 0,
        x1: ref_value,
        y1: 1,
        line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
      }];
      return return_shapes;
    }

    function update_history_elid5(){
      var start_index = display_year_elid_5.selectedIndex;
      var history_years = [start_index + 1, start_index + 2, start_index + 3];
      var history_plots = ["elid_5a", "elid_5b", "elid_5c"];
      for (var j = 0 ; j < history_years.length ; j++){
        current_display_year_elid_5 = display_year_list_elid_5[history_years[j]];
        current_sex_elid_5 = sex_elid_5.value;
        var data = [];
        var bin_filter = [];
        var count_filter = [];
        for (var i = 0 ; i < display_year_data_elid_5.length ; i++){
          if ( sex_data_elid_5[i] == current_sex_elid_5 &&
              display_year_data_elid_5[i] == current_display_year_elid_5 ){
            bin_filter.push(bin_data_elid_5[i]);
            if (effort_weighting_elid_5 == false) {
              count_filter.push(count_data_elid_5[i]);
            }
            else {
              count_filter.push(count_data_elid_5[i] / effort_data_elid_5[i]);
            }
          };
        };
        var trace1 = { type: "bar",
          x: bin_filter,
          y: count_filter,
          marker: { color: "DarkCyan", width: 1 }
        };
        if (history_years[j] < display_year_list_elid_5.length) {
          data = [trace1];
        }
        reference_shapes = get_ref_elid5(current_sex_elid_5);
        layout = {
          xaxis: { title: 'Length (mm) ' + current_display_year_elid_5, showgrid: false },
          yaxis: { title: 'Lobsters / 1000 potlifts', range: [0, max_freq_elid_5], showgrid: false },
          shapes: reference_shapes,
          margin: { l: 60, b: 60, r: 60, t: 40 }
        };
        Plotly.newPlot(history_plots[j], data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
      }
    }
    function updatePlot_elid_5(){
      current_display_year_elid_5 = display_year_elid_5.value;
      current_sex_elid_5 = sex_elid_5.value;
      var data = [];
      var bin_filter = [];
      var count_filter = [];
      for (var i = 0 ; i < display_year_data_elid_5.length ; i++){
        if ( sex_data_elid_5[i] == current_sex_elid_5 &&
            display_year_data_elid_5[i] == current_display_year_elid_5 ){
          bin_filter.push(bin_data_elid_5[i]);
          if (effort_weighting_elid_5 == false) {
            count_filter.push(count_data_elid_5[i]);
          }
          else {
            count_filter.push(count_data_elid_5[i] / effort_data_elid_5[i]);
          }
        };
      };
      var trace1 = { type: "bar",
        x: bin_filter,
        y: count_filter,
        marker: { color: "DarkCyan", width: 1 }
      };
      data = [trace1];
      reference_shapes = get_ref_elid5(current_sex_elid_5);
      layout = {
        xaxis: { title: 'Length (mm) ' + current_display_year_elid_5, showgrid: false },
        yaxis: { title: 'Lobsters / 1000 potlifts', range: [0, max_freq_elid_5], showgrid: false },
        shapes: reference_shapes,
        margin: { l: 60, b: 60, r: 60, t: 40 }
      };
      Plotly.newPlot("elid_5", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
      update_history_elid5();
    };
    getdata_elid_5();
  </script>
<br>
<!-- <button onclick="elid_5_table_display()">Show/Hide Data</button>
<div id="elid_5_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_5_table_display() {
        var x = document.getElementById('elid_5_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_LF.csv',
      element: 'elid_5_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {"paging": false, "searching": false, "autoWidth": false, "order": [[ 2, "asc" ]]}
    });
  </script>
</div> -->
<p><br>Length frequency of rock lobsters sampled in the fixed-site surveys. Displays four sequential years, with most recent year selected under the "Year" dropdown. Selectable by sex (male/female). Dashed line is legal minimum length.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.7 Average Weight</strong>
</h4>
<div class="control-row">

</div>
<div id="elid_6" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_6 = [];
    var region_data_elid_6 = [];
    var value_data_elid_6 = [];
    var display_year_list_elid_6 = [];
    var unique_region_elid_6 = [];
    var current_display_year_elid_6 = "";
    var current_region_elid_6 = "";
    var survey_id_elid_6 = "ave_weight";
    var ref_value_elid_6 = "average";

    function getdata_elid_6() {
      Plotly.d3.csv("assets/data/WEST_201706_ave_weight.csv", function(data){
        processData_elid_6(data)
      });
    };
    function processData_elid_6(allRows) {
      display_year_data_elid_6 = [];
      region_data_elid_6 = [];
      value_data_elid_6 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_6.push( row['display_year'] );
        region_data_elid_6.push( row['region'] );
        value_data_elid_6.push( Number(row['value']) );
      }
      display_year_list_elid_6 = getUniques(display_year_data_elid_6);
      unique_region_elid_6 = getUniques(region_data_elid_6);
      current_display_year_elid_6 = display_year_list_elid_6[0];
      current_region_elid_6 = unique_region_elid_6[0];
      updatePlot_elid_6();  // Put it here to fix the asynchronous function issue
    };
    function updatePlot_elid_6(){
      var data = [];
      for (var i = 0; i < unique_region_elid_6.length;  i++) {
        current_region_elid_6 = unique_region_elid_6[i];
        var curr_display_years = getFilteredArray(display_year_data_elid_6, [region_data_elid_6], [current_region_elid_6]);
        var curr_values = getFilteredArray(value_data_elid_6, [region_data_elid_6], [current_region_elid_6]);
        var curr_errors = [];
        var trace = {
          type: "scatter",
          mode: "lines",
          name: unique_region_elid_6[i],
          x: curr_display_years,
          y: curr_values,
          error_y: {
            type: 'data',
            array: curr_errors,
            visible: false
          },
          line: {
            color: lineColor(i),
            dash: lineStyle(i),
            width: 3
          }
        };
        data.push(trace);
      }
      var reference_shapes = [];
      curr_ref = getAvg(curr_values);
      reference_shapes = [{
        type: 'line',
        xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
        yref: 'y',  // y-reference is assigned to the y-values
        x0: 0,
        y0: curr_ref,
        x1: 1,
        y1: curr_ref,
        line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
      }];
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'Average lobster weight (kg)', rangemode: 'tozero', range: [0, (curr_ref * 2)]},
        shapes: reference_shapes,
        showlegend: true,
        margin: { l: 60, b: 60, r: 60, t: 40 },
        autosize: true
      };
      Plotly.newPlot("elid_6", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_6();
  </script>
</div>
<br>
<button onclick="elid_6_table_display()">Show/Hide Data</button>
<div id="elid_6_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_6_table_display() {
        var x = document.getElementById('elid_6_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_ave_weight.csv',
      element: 'elid_6_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Average weight in kg of rock lobster caught each fishing season (Nov-Sept), selectable by region (Apollo Bay, Warrnambool and Portland) and for all of fishery. Dashed line is series average.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.8 Fixed Site Survey</strong>
</h4>
<div class="control-row">
  <p>Region: <select id="elid_7-region"></select> Subgroup: <select id="elid_7-subgroup"></select></p>
</div>
<div id="elid_7" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_7 = [];
    var region_data_elid_7 = [];
    var sex_data_elid_7 = [];
    var subgroup_data_elid_7 = [];
    var value_data_elid_7 = [];
    var display_year_list_elid_7 = [];
    var unique_region_elid_7 = [];
    var unique_sex_elid_7 = [];
    var unique_subgroup_elid_7 = [];
    var current_display_year_elid_7 = "";
    var current_region_elid_7 = "";
    var current_sex_elid_7 = "";
    var current_subgroup_elid_7 = "";
    var survey_id_elid_7 = "fixed_site";
    var ref_value_elid_7 = "average";
    var region_elid_7 = document.querySelector("#elid_7-region");
    region_elid_7.addEventListener("change", updatePlot_elid_7, false);
    var subgroup_elid_7 = document.querySelector("#elid_7-subgroup");
    subgroup_elid_7.addEventListener("change", updatePlot_elid_7, false);

    function getdata_elid_7() {
      Plotly.d3.csv("assets/data/WEST_201706_fixed_site.csv", function(data){
        processData_elid_7(data)
      });
    };
    function processData_elid_7(allRows) {
      display_year_data_elid_7 = [];
      region_data_elid_7 = [];
      sex_data_elid_7 = [];
      subgroup_data_elid_7 = [];
      value_data_elid_7 = [];
      error_data_elid_7 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_7.push( row['display_year'] );
        region_data_elid_7.push( row['region'] );
        sex_data_elid_7.push( row['sex'] );
        subgroup_data_elid_7.push( row['subgroup'] );
        value_data_elid_7.push( Number(row['value']) );
      }
      display_year_list_elid_7 = getUniques(display_year_data_elid_7);
      unique_region_elid_7 = getUniques(region_data_elid_7);
      unique_sex_elid_7 = getUniques(sex_data_elid_7);
      unique_subgroup_elid_7 = getUniques(subgroup_data_elid_7);
      assignOptions(unique_region_elid_7, region_elid_7);
      assignOptions(unique_subgroup_elid_7, subgroup_elid_7);
      current_display_year_elid_7 = display_year_list_elid_7[0];
      current_region_elid_7 = unique_region_elid_7[0];
      current_sex_elid_7 = unique_sex_elid_7[0];
      current_subgroup_elid_7 = unique_subgroup_elid_7[0];
      updatePlot_elid_7();  // Put it here to fix the asynchronous function issue
    };

    function updatePlot_elid_7(){
      current_region_elid_7 = region_elid_7.value;
      current_subgroup_elid_7 = subgroup_elid_7.value;
      var data = [];
      for (var i = 0; i < unique_sex_elid_7.length;  i++) {
        current_sex_elid_7 = unique_sex_elid_7[i];
        var curr_display_years = getFilteredArray(display_year_data_elid_7, [region_data_elid_7, subgroup_data_elid_7, sex_data_elid_7], [current_region_elid_7, current_subgroup_elid_7, current_sex_elid_7]);
        var curr_values = getFilteredArray(value_data_elid_7, [region_data_elid_7,subgroup_data_elid_7, sex_data_elid_7], [current_region_elid_7, current_subgroup_elid_7, current_sex_elid_7]);
        var trace = {
          type: "scatter",
          mode: "lines",
          name: unique_sex_elid_7[i],
          x: curr_display_years,
          y: curr_values,
          line: {
            color: lineColor(i),
            dash: lineStyle(i),
            width: 3
          }
        };
        data.push(trace);
      }
      var reference_shapes = [];
      if (true) {
        switch (ref_value_elid_7) {
          case "average":
          curr_ref = getAvg(curr_values);
          break;
          default:
          curr_ref = filterFloat(ref_value_elid_7);
          if (isNaN(curr_ref)) { curr_ref = 0; }
          break;
        }
        reference_shapes = [{
          type: 'line',
          xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
          yref: 'y',  // y-reference is assigned to the y-values
          x0: 0,
          y0: curr_ref,
          x1: 1,
          y1: curr_ref,
          line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
        }];
      }
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'CPUE (kg/potlift)', rangemode: 'tozero'},
        shapes: reference_shapes,
        showlegend: true,
        margin: { l: 60, b: 60, r: 60, t: 40 },
        autosize: true
      };
      Plotly.newPlot("elid_7", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_7();
  </script>
</div>
<br>
<button onclick="elid_7_table_display()">Show/Hide Data</button>
<div id="elid_7_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_7_table_display() {
        var x = document.getElementById('elid_7_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_fixed_site.csv',
      element: 'elid_7_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ]]
      }
    });
  </script>
</div>
<p><br>CPUE for rock lobster caught at fisheries-independent fixed-site surveys, selectable by sex (male/female) and size (juvenile/adult). Data displayed by fishing season (Nov-Sept). These surveys use pots with escape gaps closed. Dashed line is series average.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>1.9 Observer Survey</strong>
</h4>
<div class="control-row">
  <p>Subgroup: <select id="elid_8-subgroup"></select></p>
</div>
<div id="elid_8" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_8 = [];
    var region_data_elid_8 = [];
    var sex_data_elid_8 = [];
    var subgroup_data_elid_8 = [];
    var value_data_elid_8 = [];
    var display_year_list_elid_8 = [];
    var unique_region_elid_8 = [];
    var unique_sex_elid_8 = [];
    var unique_subgroup_elid_8 = [];
    var current_display_year_elid_8 = "";
    var current_region_elid_8 = "";
    var current_sex_elid_8 = "";
    var current_subgroup_elid_8 = "";
    var survey_id_elid_8 = "observer";
    var ref_value_elid_8 = "average";
    var subgroup_elid_8 = document.querySelector("#elid_8-subgroup");
    subgroup_elid_8.addEventListener("change", updatePlot_elid_8, false);

    function getdata_elid_8() {
      Plotly.d3.csv("assets/data/WEST_201706_observer.csv", function(data){
        processData_elid_8(data)
      });
    };
    function processData_elid_8(allRows) {
      display_year_data_elid_8 = [];
      region_data_elid_8 = [];
      sex_data_elid_8 = [];
      subgroup_data_elid_8 = [];
      value_data_elid_8 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_8.push( row['display_year'] );
        region_data_elid_8.push( row['region'] );
        sex_data_elid_8.push( row['sex'] );
        subgroup_data_elid_8.push( row['subgroup'] );
        value_data_elid_8.push( Number(row['value']) );
      }
      display_year_list_elid_8 = getUniques(display_year_data_elid_8);
      unique_region_elid_8 = getUniques(region_data_elid_8);
      unique_sex_elid_8 = getUniques(sex_data_elid_8);
      unique_subgroup_elid_8 = getUniques(subgroup_data_elid_8);
      assignOptions(unique_subgroup_elid_8, subgroup_elid_8);
      current_display_year_elid_8 = display_year_list_elid_8[0];
      current_region_elid_8 = unique_region_elid_8[0];
      current_sex_elid_8 = unique_sex_elid_8[0];
      current_subgroup_elid_8 = unique_subgroup_elid_8[0];
      updatePlot_elid_8();  // Put it here to fix the asynchronous function issue
    };

    function updatePlot_elid_8(){
      current_subgroup_elid_8 = subgroup_elid_8.value;
      var data = [];
      for (var i = 0; i < unique_sex_elid_8.length;  i++) {
        current_sex_elid_8 = unique_sex_elid_8[i];
        var curr_display_years = getFilteredArray(display_year_data_elid_8, [sex_data_elid_8, subgroup_data_elid_8], [current_sex_elid_8, current_subgroup_elid_8]);
        var curr_values = getFilteredArray(value_data_elid_8, [sex_data_elid_8, subgroup_data_elid_8], [current_sex_elid_8, current_subgroup_elid_8]);
        var curr_errors = [];
        var trace = {
          type: "scatter",
          mode: "lines",
          name: unique_sex_elid_8[i],
          x: curr_display_years,
          y: curr_values,
          error_y: {
            type: 'data',
            array: curr_errors,
            visible: false
          },
          line: {
            color: lineColor(i),
            dash: lineStyle(i),
            width: 3
          }
        };
        data.push(trace);
      }
      var reference_shapes = [];
      curr_ref = getAvg(curr_values);
      reference_shapes = [{
        type: 'line',
        xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
        yref: 'y',  // y-reference is assigned to the y-values
        x0: 0,
        y0: curr_ref,
        x1: 1,
        y1: curr_ref,
        line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
      }];
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'CPUE (kg/potlift)', rangemode: 'tozero'},
        shapes: reference_shapes,
        showlegend: true,
        margin: { l: 60, b: 60, r: 60, t: 40 },
        autosize: true
      };
      Plotly.newPlot("elid_8", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_8();
  </script>
</div>
<br>
<button onclick="elid_8_table_display()">Show/Hide Data</button>
<div id="elid_8_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_8_table_display() {
        var x = document.getElementById('elid_8_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_observer.csv',
      element: 'elid_8_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ]]
      }
    });
  </script>
</div>
<p><br>CPUE for rock lobster recorded by on-board observers, selectable by sex (male/female) and size (juvenile/adult). Data displayed by fishing season (Nov-Sept). These surveys use regular commercial pots with escape gaps open. Dashed line is series average.<br></p>

</div>
<div role="tabpanel" class="tab-pane" id="monthly">

<br><h4 align="center">
  <strong>2.1 Current Season Data</strong>
</h4>
<div id="table_monthly_highlight" style="width: 960px;">
  <script type="text/javascript">
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_monthly_highlight.csv',
      element: 'table_monthly_highlight',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 0, "asc" ]]
      }
    });
  </script>
</div>
<br>
<p>TACC, landed catch and uncaught quota for current quota season (Jul-Jun). Data derived from the phone-based Quota Monitoring System.</p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>2.2 Monthly Data Trends</strong>
</h4>
<div class="control-row">
  <p>Plot variable: <select id="elid_1-survey"></select></p>
</div>
<div id="elid_1" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_1 = [];
    var month_seq_data_elid_1 = [];
    var month_data_elid_1 = [];
    var survey_data_elid_1 = [];
    var region_data_elid_1 = [];
    var value_data_elid_1 = [];
    var unique_display_year_elid_1 = [];
    var unique_survey_elid_1 = [];
    var unique_region_elid_1 = [];
    var month_seq_list_elid_1 = [];
    var month_list_elid_1 = [];
    var current_survey_elid_1 = "";
    var ref_tac_elid_1 = 209217;
    var survey_elid_1 = document.querySelector("#elid_1-survey");
    survey_elid_1.addEventListener("change", updatePlot_elid_1, false);

    function getdata_elid_1() {
      Plotly.d3.csv("assets/data/WEST_201706_monthly.csv", function(data){
        processData_elid_1(data)
      });
    };
    function processData_elid_1(allRows) {
      display_year_data_elid_1 = [];
      month_seq_data_elid_1 = [];
      month_data_elid_1 = [];
      survey_data_elid_1 = [];
      region_data_elid_1 = [];
      value_data_elid_1 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_1.push( row['display_year'] );
        month_seq_data_elid_1.push( row['month_seq'] );
        month_data_elid_1.push( row['month'] );
        survey_data_elid_1.push( row['survey_id'] );
        region_data_elid_1.push( row['region'] );
        value_data_elid_1.push( Number(row['value']) );
      }
      unique_display_year_elid_1 = getUniques(display_year_data_elid_1);
      unique_survey_elid_1 = getUniques(survey_data_elid_1);
      unique_region_elid_1 = getUniques(region_data_elid_1);
      month_seq_list_elid_1 = getUniques(month_seq_data_elid_1);
      month_list_elid_1 = getUniques(month_data_elid_1);
      assignOptions(unique_survey_elid_1, survey_elid_1);
      current_survey_elid_1 = unique_survey_elid_1[0];
      updatePlot_elid_1();  // Put it here to fix the asynchronous function issue
    };
    function getAxis_elid_1(input){
      if (input == "Catch (cum)"){
        return "Cumulative Catch (kg)"
      } else if (input == "CPUE"){
        return "CPUE (kg/potlift)"
      } else if (input == "Catch"){
        return "Catch (kg)"
      } else if (input == "Effort"){
        return "Effort (potlifts)"
      }
    }
    function updatePlot_elid_1(){
      current_survey_elid_1 = survey_elid_1.value;
      var data = [];
      for (var i = 0; i < unique_display_year_elid_1.length;  i++) {
        var curr_months = getFilteredArray(month_data_elid_1, [display_year_data_elid_1, survey_data_elid_1], [unique_display_year_elid_1[i], current_survey_elid_1]);
        var curr_values = getFilteredArray(value_data_elid_1, [display_year_data_elid_1, survey_data_elid_1], [unique_display_year_elid_1[i], current_survey_elid_1]);
        var trace = {
          type: "scatter",
          mode: "lines",
          name: unique_display_year_elid_1[i],
          x: curr_months,
          y: curr_values,
          line: {
            color: lineColor(i),
            dash: lineStyle(i),
            width: 3
          }
        };
        data.push(trace);
      }
      var reference_shapes = [];
      if (current_survey_elid_1 == "Catch (cum)") {
        reference_shapes = [{
          type: 'line',
          xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
          yref: 'y',  // y-reference is assigned to the y-values
          x0: 0,
          y0: ref_tac_elid_1,
          x1: 1,
          y1: ref_tac_elid_1,
          line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
        }];
      }
      layout = {
        xaxis: { title: ''},
        yaxis: { title: getAxis_elid_1(current_survey_elid_1), rangemode: 'tozero'},
        showlegend: true,
        shapes: reference_shapes,
        margin: { l: 60, b: 60, r: 60, t: 40 }
      };
      Plotly.newPlot("elid_1", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_1();
  </script>
</div>
<br>
<button onclick="elid_1_table_display()">Show/Hide Data</button>
<div id="elid_1_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_1_table_display() {
        var x = document.getElementById('elid_1_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_monthly.csv',
      element: 'elid_1_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 3, "asc" ], [ 0, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Monthly update of key fishery statistics for the current and previous quota season (Jun-July). Selectable as monthly catch, cumulative catch, or monthly CPUE. Data presented is for the whole fishery. TAC for current year is indicated by a dashed grey line.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>2.3 Monthly Landed Catch</strong>
</h4>
<div id="table_monthly_landed" style="width: 960px;">
  <script type="text/javascript">
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_monthly_landed.csv',
      element: 'table_monthly_landed',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 0, "asc" ]]
      }
    });
  </script>
</div>
<br>
<p>Monthly landed catch. Data derived from the phone-based Quota Monitoring System.</p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>2.4 Monthly Catch Rates</strong>
</h4>
<div id="table_monthly_catch_rate" style="width: 960px;">
  <script type="text/javascript">
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_monthly_catch_rate.csv',
      element: 'table_monthly_catch_rate',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 0, "asc" ]]
      }
    });
  </script>
</div>
<br>
<p>Monthly average catch rates. Data derived from the phone-based Quota Monitoring System.</p>

</div>
<div role="tabpanel" class="tab-pane" id="models">

<br><h4 align="center">
  <strong>3.1 Standardised CPUE</strong>
</h4>
<div id="elid_9" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_9 = [];
    var region_data_elid_9 = [];
    var value_data_elid_9 = [];
    var display_year_list_elid_9 = [];
    var unique_region_elid_9 = [];
    var current_display_year_elid_9 = "";
    var current_region_elid_9 = "";
    var survey_id_elid_9 = "cpue_stan";
    var ref_value_elid_9 = "0.0";

    function getdata_elid_9() {
      Plotly.d3.csv("assets/data/WEST_201706_cpue_stan.csv", function(data){
        processData_elid_9(data)
      });
    };
    function processData_elid_9(allRows) {
      display_year_data_elid_9 = [];
      region_data_elid_9 = [];
      value_data_elid_9 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_9.push( row['display_year'] );
        region_data_elid_9.push( row['region'] );
        value_data_elid_9.push( Number(row['value']) );
      }
      display_year_list_elid_9 = getUniques(display_year_data_elid_9);
      unique_region_elid_9 = getUniques(region_data_elid_9);
      current_display_year_elid_9 = display_year_list_elid_9[0];
      current_region_elid_9 = unique_region_elid_9[0];
      updatePlot_elid_9();  // Put it here to fix the asynchronous function issue
    };

    function updatePlot_elid_9(){
      var data = [];
      for (var i = 0; i < unique_region_elid_9.length;  i++) {
        var curr_display_years = getFilteredArray(display_year_data_elid_9, [region_data_elid_9], [unique_region_elid_9[i]]);
        var curr_values = getFilteredArray(value_data_elid_9, [region_data_elid_9], [unique_region_elid_9[i]]);
        var curr_errors = [];
        var trace = {
          type: "scatter",
          mode: "lines",
          name: unique_region_elid_9[i],
          x: curr_display_years,
          y: curr_values,
          line: {
            color: lineColor(i),
            dash: lineStyle(i),
            width: 3
          }
        };
        data.push(trace);
      }
      var reference_shapes = [];
      curr_ref = getAvg(curr_values);
      reference_shapes = [{
        type: 'line',
        xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
        yref: 'y',  // y-reference is assigned to the y-values
        x0: 0,
        y0: curr_ref,
        x1: 1,
        y1: curr_ref,
        line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
      }];
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'CPUE (kg/potlift)', rangemode: 'tozero'},
        shapes: reference_shapes,
        showlegend: true,
        margin: { l: 60, b: 60, r: 60, t: 40 },
        autosize: true
      };
      Plotly.newPlot("elid_9", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_9();
  </script>
</div>
<br>
<button onclick="elid_9_table_display()">Show/Hide Data</button>
<div id="elid_9_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_9_table_display() {
        var x = document.getElementById('elid_9_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_cpue_stan.csv',
      element: 'elid_9_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ], [ 0, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Annual time series of standardised catch-per-unit effort (CPUE) (kg/potlift), plotted by region.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>3.2 Relative Abundance of Recruits</strong>
</h4>
<div class="control-row">

</div>
<div id="elid_10" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_10 = [];
    var region_data_elid_10 = [];
    var value_data_elid_10 = [];
    var display_year_list_elid_10 = [];
    var unique_region_elid_10 = [];
    var current_display_year_elid_10 = "";
    var current_region_elid_10 = "";
    var survey_id_elid_10 = "recruits";
    var ref_value_elid_10 = "1.0";

    function getdata_elid_10() {
      Plotly.d3.csv("assets/data/WEST_201706_recruits.csv", function(data){
        processData_elid_10(data)
      });
    };
    function processData_elid_10(allRows) {
      display_year_data_elid_10 = [];
      region_data_elid_10 = [];
      value_data_elid_10 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_10.push( row['display_year'] );
        region_data_elid_10.push( row['region'] );
        value_data_elid_10.push( Number(row['value']) );
      }
      display_year_list_elid_10 = getUniques(display_year_data_elid_10);
      unique_region_elid_10 = getUniques(region_data_elid_10);
      current_display_year_elid_10 = display_year_list_elid_10[0];
      current_region_elid_10 = unique_region_elid_10[0];
      updatePlot_elid_10();  // Put it here to fix the asynchronous function issue
    };

    function updatePlot_elid_10(){
      var data = [];
      var curr_display_years = getFilteredArray(display_year_data_elid_10, [region_data_elid_10], [current_region_elid_10]);
      var curr_values = getFilteredArray(value_data_elid_10, [region_data_elid_10], [current_region_elid_10]);
      var curr_errors = [];
      var trace = {
        type: "scatter",
        mode: "lines",
        x: curr_display_years,
        y: curr_values,
        error_y: {
          type: 'data',
          array: curr_errors,
          visible: false
        },
        marker: {
          color: "RoyalBlue",
          width: 3
        }
      };
      data.push(trace);
      var reference_shapes = [];
      if (true) {
        switch (ref_value_elid_10) {
          case "average":
          curr_ref = getAvg(curr_values);
          break;
          default:
          curr_ref = filterFloat(ref_value_elid_10);
          if (isNaN(curr_ref)) { curr_ref = 0; }
          break;
        }
        reference_shapes = [{
          type: 'line',
          xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
          yref: 'y',  // y-reference is assigned to the y-values
          x0: 0,
          y0: curr_ref,
          x1: 1,
          y1: curr_ref,
          line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
        }];
      }
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'Relative abundance of recruits', rangemode: 'tozero'},
        shapes: reference_shapes,
        showlegend: false,
        margin: { l: 60, b: 60, r: 60, t: 40 },
        autosize: true
      };
      Plotly.newPlot("elid_10", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_10();
  </script>
</div>
<br>
<button onclick="elid_10_table_display()">Show/Hide Data</button>
<div id="elid_10_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_10_table_display() {
        var x = document.getElementById('elid_10_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_recruits.csv',
      element: 'elid_10_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ], [ 0, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Relative abundance of recruits (<60mm), as estimated by the rock lobster model, from 1978/79 to present.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>3.3 Modelled Egg Production</strong>
</h4>
<div class="control-row">

</div>
<div id="elid_11" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_11 = [];
    var region_data_elid_11 = [];
    var value_data_elid_11 = [];
    var display_year_list_elid_11 = [];
    var unique_region_elid_11 = [];
    var current_display_year_elid_11 = "";
    var current_region_elid_11 = "";
    var survey_id_elid_11 = "egg_prod";
    var ref_value_elid_11 = "20.0";

    function getdata_elid_11() {
      Plotly.d3.csv("assets/data/WEST_201706_egg_prod.csv", function(data){
        processData_elid_11(data)
      });
    };
    function processData_elid_11(allRows) {
      display_year_data_elid_11 = [];
      region_data_elid_11 = [];
      value_data_elid_11 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        display_year_data_elid_11.push( row['display_year'] );
        region_data_elid_11.push( row['region'] );
        value_data_elid_11.push( Number(row['value']) );
      }
      display_year_list_elid_11 = getUniques(display_year_data_elid_11);
      unique_region_elid_11 = getUniques(region_data_elid_11);
      current_display_year_elid_11 = display_year_list_elid_11[0];
      current_region_elid_11 = unique_region_elid_11[0];
      updatePlot_elid_11();  // Put it here to fix the asynchronous function issue
    };

    function updatePlot_elid_11(){
      var data = [];
      var curr_display_years = getFilteredArray(display_year_data_elid_11, [region_data_elid_11], [current_region_elid_11]);
      var curr_values = getFilteredArray(value_data_elid_11, [region_data_elid_11], [current_region_elid_11]);
      var curr_errors = [];
      var trace = {
        type: "scatter",
        mode: "lines",
        x: curr_display_years,
        y: curr_values,
        error_y: {
          type: 'data',
          array: curr_errors,
          visible: false
        },
        marker: {
          color: "DarkSlateBlue",
          width: 3
        }
      };
      data.push(trace);
      var reference_shapes = [];
      if (true) {
        switch (ref_value_elid_11) {
          case "average":
          curr_ref = getAvg(curr_values);
          break;
          default:
          curr_ref = filterFloat(ref_value_elid_11);
          if (isNaN(curr_ref)) { curr_ref = 0; }
          break;
        }
        reference_shapes = [{
          type: 'line',
          xref: 'paper',  // x-reference is assigned to the plot paper [0,1]
          yref: 'y',  // y-reference is assigned to the y-values
          x0: 0,
          y0: curr_ref,
          x1: 1,
          y1: curr_ref,
          line: { color: 'DarkSlateGrey', width: 2, dash: 'dash'}
        }];
      }
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'Modelled egg production', rangemode: 'tozero'},
        shapes: reference_shapes,
        showlegend: false,
        margin: { l: 60, b: 60, r: 60, t: 40 },
        autosize: true
      };
      Plotly.newPlot("elid_11", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_11();
  </script>
</div>
<br>
<button onclick="elid_11_table_display()">Show/Hide Data</button>
<div id="elid_11_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_11_table_display() {
        var x = document.getElementById('elid_11_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_egg_prod.csv',
      element: 'elid_11_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ], [ 0, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Model estimated Rock lobster egg production, as percentage of the estimated 1951 level. Dashed line is the limit reference point from the Harvest strategy.<br></p>

<div class="hr-divider" style="margin-top: 60px" xmlns="http://www.w3.org/1999/html"></div>
<br><h4 align="center">
  <strong>3.4 Estimated Biomass & Exploitation</strong>
</h4>
<div class="control-row">

</div>
<div id="elid_12" style="height: 450px; width: 960px;" class="plotly-graph-div">
  <script>
    var display_year_data_elid_12 = [];
    var region_data_elid_12 = [];
    var biomass_data_elid_12 = [];
    var exploitation_data_elid_12 = [];
    var display_year_list_elid_12 = [];
    var unique_region_elid_12 = [];
    var current_display_year_elid_12 = "";
    var current_region_elid_12 = "";
    var biomass_id_elid_12 = "biomass";
    var exploitation_id_elid_12 = "exploitation";

    function getdata_elid_12() {
      Plotly.d3.csv("assets/data/WEST_201706_biomass_ex.csv", function(data){
        processData_elid_12(data)
      });
    };
    function processData_elid_12(allRows) {
      display_year_data_elid_12 = [];
      region_data_elid_12 = [];
      biomass_data_elid_12 = [];
      exploitation_data_elid_12 = [];
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        if (row['survey_id'] == biomass_id_elid_12) {
          display_year_data_elid_12.push( row['display_year'] );
          region_data_elid_12.push( row['region'] );
          biomass_data_elid_12.push( Number(row['value']) );
        }
        if (row['survey_id'] == exploitation_id_elid_12) {
          display_year_data_elid_12.push( row['display_year'] );
          region_data_elid_12.push( row['region'] );
          exploitation_data_elid_12.push( Number(row['value']) );
        }
      }
      display_year_list_elid_12 = getUniques(display_year_data_elid_12);
      unique_region_elid_12 = getUniques(region_data_elid_12);
      updatePlot_elid_12();  // Put it here to fix the asynchronous function issue
    };

    function updatePlot_elid_12(){
      var data = [];
      var curr_display_years = display_year_data_elid_12;
      var curr_biomass = biomass_data_elid_12;
      var curr_exploitation = exploitation_data_elid_12;
      var trace1 = {
        type: "bar",
        name: "Est biomass",
        x: curr_display_years,
        y: curr_biomass,
        marker: {
          color: "DarkCyan",
          width: 1
        }
      };
      var trace2 = {
        type: "scatter",
        mode: "lines",
        name: "Est exploitation",
        x: curr_display_years,
        y: curr_exploitation,
        yaxis: "y2",
        line: {
          color: "DarkSlateBlue",
          width: 3
        }
      };
      data = [trace1, trace2];
      layout = {
        xaxis: { title: ''},
        yaxis: { title: 'Est biomass (kg)', rangemode: 'tozero'},
        yaxis2: { title: "Exploitation (Proportion of biomass)",
          rangemode: "tozero",
          overlaying: "y",
          side: "right"
        },
        margin: { l: 60, b: 60, r: 60, t: 40 },
        legend: {
          "orientation": "h",
          "x": 0.6,
          "y": 1.05
        },
        showlegend: true,
      };
      Plotly.newPlot("elid_12", data, layout, {modeBarButtonsToRemove: ["sendDataToCloud"], displaylogo: false});
    };
    getdata_elid_12();
  </script>
</div>
<br>
<button onclick="elid_12_table_display()">Show/Hide Data</button>
<div id="elid_12_table" style="width: 960px; display: none" >
  <script type="text/javascript">
    function elid_12_table_display() {
        var x = document.getElementById('elid_12_table');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }
    CsvToHtmlTable.init({
      csv_path: 'assets/data/WEST_201706_biomass_ex.csv',
      element: 'elid_12_table',
      allow_download: false,
      csv_options: {separator: ',', delimiter: '"'},
      datatables_options: {
        "paging": false,
        "searching": false,
        "autoWidth": false,
        "order": [[ 1, "asc" ], [ 0, "asc" ]]
      }
    });
  </script>
</div>
<p><br>Model estimated available biomass and proportional exploitation in the Rock lobster fishery from 1978/79 to present.<br></p>

</div>
</div>
</div>
</body>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="assets/js/bootstrap.min.js"></script>



</html>
